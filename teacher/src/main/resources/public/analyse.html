<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>成绩分析</title>
    <meta charset="UTF-8">
    <title>analyse</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--    <script src="https://cdn.bootcss.com/echarts/3.7.1/echarts.min.js"></script>-->
    <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
    <link rel="stylesheet" href="assets/css/analyse.css">
</head>
<body onload="init()">
<style type="text/css">
    a.hand:hover   {cursor:hand}
    .pie {
        width:160px;
        height:160px;
        margin: 0 auto;
    }
</style>
<div class="viewFrameWork sidebar-full" id="viewFrameWork">
    <div class="body-toolbar clearfix">
        <ul class="scoreAnalysisContentBar ksx-tabs-card">
            <div class="active scoreAnalysisBarOne ksx-tab-item" id="score">
                <a href="stuList.html">成绩分析</a>
            </div>
            <div class="scoreAnalysisBarTwo ksx-tab-item" id="scoreInterval">
                <button type="button"
                        class="btn btn-default "
                        onclick="zhu()">学员信息</button>
            </div>
            <div class="scoreAnalysisBarThree ksx-tab-item" id="scoreExamine">
                <a href="javascript:void(0);">试题分析</a>
            </div>
        </ul>
    </div>
</div>
<div class="outer">
    <div class="exam shadow-lg p-3 mb-5 bg-white rounded" >
        <div class="scoreAnalysis">
            <div class="examContentWrap">
                <div id="examId"></div>
                <div class="examContentTitle content examName" id="examName">考试科目</div>
                <div class="examContent">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-row">
                                <span class="title">总分:</span>
                                <span id="examTotalScore"></span>分
                            </div>
                            <div class="form-row">
                                <span class="title">及格分:</span>
                                <span id="passMark"></span>分
                            </div>

                            <div class="form-row">
                                <span class="title">答题时长:</span>
                                <span id="examTime"></span>
                            </div>
                            <div class="form-row">
                                <span class="title">考试时间:</span>
                                <span id="examTimeInterval"></span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-row">
                                <span class="title">应考人数:</span>
                                <span id="examineNums"></span>
                            </div>
                            <div class="form-row">
                                <span class="title">平均分:</span>
                                <span id="avgScore"></span>分
                            </div>
                            <div class="form-row">
                                <span class="title">最高分:</span>
                                <span id="maxScore"></span>分
                            </div>
                            <div class="form-row">
                                <span class="title">最低分:</span>
                                <span id="minScore"></span>分
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--全班成绩统计-->
        <div class="inner">
            <div class="score tabContent" >
                <div class="scoreAnalysisFun clear">
                    <div class="scoreAnalysisGrid">
                        <button type="button" class="btn btn-default export scoreExport pull-right" id="scoreExport">导出答题情况</button>
                        <table class="table table-bordered table-hover table-striped">
                            <thead>
                            <tr>
                                <td id="examineNum">应考人数</td>
                                <td id="passPercent">及格率</td>
                                <td id="max-Score">最高分</td>
                                <td id="min-Score">最低分</td>
                                <td id="avg-Score">平均分</td>
                            </tr>
                            </thead>

                            <tbody id="data">
                            </tbody>

                            <tfoot>
                            <tr id="table bottom" class="table-bordered">
                                <td colspan=5">
                                    <div id="page_div">
                                        <div id="right">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        </br>
        <div id="bottom">
            <div id="box1" class="pie"></div>
            <div id="box2" class="pie"></div>
        </div>

    </div>

</div>

<script>
    var Barlist=[];
    var BarArr;

    function init(){
        var personNum;
        var avg1,max1,min1;
        var examId = sessionStorage.getItem("id");
        var classId=sessionStorage.getItem("classId");
        var examName=sessionStorage.getItem("examName");
        var startTime=sessionStorage.getItem("startTime");
        var testTime=sessionStorage.getItem("testTime");
        var totalScore=sessionStorage.getItem("totalScore");

        sessionStorage.setItem("examId",examId);
        jQuery("#examName").html(examName);
        jQuery("#examTimeInterval").html(startTime);
        jQuery("#examTime").html(testTime);
        jQuery("#examTotalScore").html(totalScore);
        jQuery("#passMark").html(totalScore*0.6);


        var param={
            "examId":examId
        };
        console.log(param);
        jQuery.post("/teacher/analyse/count",param,function(data){
            console.log(data);
            jQuery("#examineNums").html(data);
            jQuery("#examineNum").html(data);
            personNum=data;

        })
        jQuery.post("/teacher/analyse/max",param,function (max){
            jQuery("#maxScore").html(max);
            jQuery("#max-Score").html(max);
            max1=max;
        })

        jQuery.post("/teacher/analyse/min",param,function (min){
            jQuery("#minScore").html(min);
            jQuery("#min-Score").html(min);
            min1=min;
        })

        jQuery.post("/teacher/analyse/avg",param,function (avg){
            jQuery("#avgScore").html(avg);
            jQuery("#avg-Score").html(avg);
            avg1=avg;
        })

        console.log(personNum);

        var trs="";
        trs+=`
            <tr>
                <td>${personNum}</td>
                <td>60%</td>
                <td>${max1}</td>
                <td>${min1}</td>
                <td>${avg1}</td>
            </tr>
            `;

        jQuery('#data').html(trs);

        var param1={
            "examId":examId,
            "totalScore":totalScore,
            "personNum":6
        };
        console.log(param1);

        var myChart = echarts.init(document.getElementById('box1'));
        // 指定图表的配置项和数据
        var option = {
            title: {
                text: ''
            },
            series: [{
                name: '比例',
                type: 'pie',
                colorByPoint: true,
                center: ['50%', '50%'], // 饼图的圆心坐标
                radius: ['60%', '70%'],
                avoidLabelOverlap: false,
                hoverAnimation: false,
                label: { //  饼图图形上的文本标签
                    normal: { // normal 是图形在默认状态下的样式
                        show: true,
                        position: 'center',
                        color: '#000000',
                        fontSize: 14,
                        fontWeight: 'bold',
                        formatter: '{b}\n{c}%' // {b}:数据名； {c}：数据值； {d}：百分比
                    }
                },
                data: [
                    {
                        value: '',
                        name:'及格率',
                        label: {
                            normal: {
                                show: true
                            }
                        }
                    },

                    {
                        value: '',
                        name: '',
                        label: {
                            normal: {
                                show: false
                            }
                        }

                    }
                ],
            }]
        };
        var pass;
        var excellent;
        console.log(avg1);
        jQuery.post("/teacher/analyse/percentage",param1,function(rst){
            console.log(rst);
            BarArr=rst;
            for(var i=0;i<BarArr.length;i++){
                if(i==3){
                    pass=BarArr[3];
                }
                if(i==4){
                    excellent=BarArr[4];
                    pass=pass+BarArr[4];
                }
            }

            var pass=parseFloat(pass/7)*100;
            console.log(pass);
            option.series[0].data.push(pass);
            var unpass=100-pass;
            console.log(unpass);
            option.series[0].data.push(unpass);
            //option.series[0].data.push(excellent);
            //option.series[0].data.push(avg1);
            myChart.setOption(option);
        })
        sessionStorage.setItem("personNum",personNum);
    }
</script>
<script>
    function search(){
        window.location.href="stuList.html";
    }
    function zhu(){
        window.location.href="test.html";
    }
</script>
<!--pie图-->
<script>
    function pie(){
        var examId = sessionStorage.getItem("id");
        var totalScore=sessionStorage.getItem("totalScore");
        var personNum=$("#examineNum").val();
        var param1={
            "examId":examId,
            "totalScore":totalScore,
            "personNum":6
        };

        var myChart = echarts.init(document.getElementById('bar'));
        // 指定图表的配置项和数据
        var option1 = {
            backgroundColor:'#FAFAD2',
            title: {
                text: '各分数段比例统计',
                left: 'center',
                //标题栏的高度，值越大，距离顶部的距离越大
                top: 50,
                //标题栏字体的颜色
                textStyle: {
                    color: '#FFD700'
                }
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data: ['0-20','20-40','40-60','60-80','80-100']
            },
            visualMap: {
                show: false,
                //饼图中在最大值最小值颜色范围中的亮度，值越大颜色越深
                min:10,
                max: 600,
                inRange: {
                    //0-1之间，值越小颜色越深
                    colorLightness: [0, 1]
                }
            },
            series : [
                {
                    //饼图中内容介绍
                    name:'各分数段统计',
                    //统计表的类型
                    type:'pie',
                    //饼图的弧度，值越小生成的饼状图越小
                    radius : '60%',
                    //饼图生成后的位置
                    center: ['50%', '50%'],
                    data:[
                        {value:'', name:'0-20'},
                        {value:'', name:'20-40'},
                        {value:'', name:'40-60'},
                        {value:'', name:'60-80'},
                        {value:'', name:'80-100'}
                    ],
                    itemStyle: {
                        normal:{
                            label:{
                                show:true,
                                formatter: "{b} :\n  {c} \n ({d}%)",
                                position:"inner"
                            }
                        }
                    },
                    roseType: 'radius',
                    //饼状图的外围标签
                    label: {
                        normal: {
                            textStyle: {
                                color: 'rgba(0, 0, 0, 0.3)'
                            }
                        }
                    },
                    //指向外围标签的线条
                    labelLine: {
                        normal: {
                            lineStyle: {
                                color: 'rgba(0, 0, 255, 0.3)'
                            },
                            smooth: 0.2,
                            length: 10,
                            length2: 20
                        }
                    },
                    itemStyle: {
                        normal: {
                            //具体决定了饼状图每一份的颜色显示
                            color: '#FFA07A',
                            //饼状图阴影，值越大阴影亮度越高
                            shadowBlur: 200,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                }
            ]
        };
        jQuery.post("/teacher/analyse/percentage",param1,function(rst){
            console.log(rst);
            BarArr=rst;
            for(var i=0;i<BarArr.length;i++){
                option1.series[0].data.push(BarArr[i]);
            }
            myChart.setOption(option);
        })
    }
</script>

</body>


</html>