<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>成绩分析</title>
    <meta charset="UTF-8">
    <title>analyse</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!--    <script src="https://cdn.bootcss.com/echarts/3.7.1/echarts.min.js"></script>-->
    <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
</head>
<body onload="init()">
<style type="text/css">
    a.hand:hover   {cursor:hand}
</style>
<style>
    .examContentWrap {
        background: #fff;
        padding: 25px 40px 0;
        margin-bottom: 20px;
        border: 1px solid #DEDEDE;
    }
    .examContentWrap {
        background: #fff;
        padding: 25px 40px 0;
        margin-bottom: 20px;
        border: 1px solid #DEDEDE;
    }
    .examContentTitle, .testAnalysisTitle, .questionAnalysisTitle{
        margin-bottom: 20px;
        font-size: 20px;
        color:  #27274A;
        border-bottom: 1px solid #DBDDE6;
        padding-bottom: 25px;
    }
    .examContent .form-row {
        margin-bottom: 20px;
    }
    .examContent .form-row .title {
        color: #9090A4;
        display: inline-block;
        width: 70px;
    }
    .examContent .form-row .content {
        color: #4A4A4A;
    }
    .examContent .form-row .content.active {
        color: #1A8CFE;
        cursor: pointer;
        text-decoration: underline;
    }
    .free-trail-modal .modal-dialog {
        width: 600px;
        margin: 15vh auto;
        border-radius: 10px;
        overflow: auto;
    }
    .free-trail-modal .modal-content {
        padding: 0;
        border-radius: 10px;
        border: none;
    }
    /* modal header */
    .free-trail-modal .modal-content .modal-header {
        height: auto;
        padding: 0;
        position: relative;
        background: url("https://s4.kaoshixing.com/static/vue/images/free-trail/free-trail-dialog-bg.png?v=07505532b2") center/cover;
        text-align: center;
    }
    .free-trail-modal .modal-content .modal-header > .image {
        width: 100px;
        height: 121px;
        margin: 25px auto 0;
    }
    .free-trail-modal .modal-content .modal-header .title {
        font-size: 20px;
        line-height: 28px;
        color: #fff;
        padding: 7px 0 22px;
    }
    .free-trail-modal .modal-content .modal-header .title .image {
        width: 22px;
        height: 22px;
        vertical-align: -5px;
    }
    /* modal body */
    .free-trail-modal .modal-content .modal-body {
        padding: 40px 50px;
        margin: 0;
        overflow: auto;
        text-align: left;
    }
    .free-trail-modal .modal-content .modal-body .list .list-item {
        font-size: 16px;
        line-height: 22px;
        color: #27274a;
        padding: 0 0 0 20px;
    }
    .free-trail-modal .modal-content .modal-body .list .list-item::before {
        content: "";
        display: inline-block;
        width: 12px;
        height: 12px;
        margin-left: -12px;
        transform: translateX(-8px);
        background: #cadaff;
        border-radius: 50%;
    }
    .free-trail-modal .modal-content .modal-body .list .list-item .strong {
        color: #1269ff;
        font-weight: 500;
    }
    /* modal footer */
    .free-trail-modal .modal-footer {
        text-align: center;
        padding: 0 0 30px;
        border: none;
    }
    .free-trail-modal .modal-footer .btn {
        font-size: 18px;
        line-height: 25px;
        padding: 10px 54px;
        border: none;
        border-radius: 24px;
        background: linear-gradient(to right, #1b75ff, #0058ff);
    }
</style>
<div class="viewFrameWork sidebar-full" id="viewFrameWork">
    <div class="body-toolbar clearfix">
        <ul class="scoreAnalysisContentBar ksx-tabs-card">
            <li class="active scoreAnalysisBarOne ksx-tab-item" id="score">
                <button type="button"
                        class="btn btn-default "
                        onclick="search()">查看学生成绩单</button>
            </li>
            <li class="scoreAnalysisBarTwo ksx-tab-item" id="scoreInterval">
                <button type="button"
                        class="btn btn-default "
                        onclick="zhu()">柱状图</button>
            </li>
            <li class="scoreAnalysisBarThree ksx-tab-item" id="scoreExamine">
                <a href="javascript:void(0);">学员信息</a>
            </li>
        </ul>
    </div>
</div>
<div class="exam shadow-lg p-3 mb-5 bg-white rounded" >
    <div class="scoreAnalysis">
        <div class="examContentWrap">
            <div id="examId"></div>
            <div class="examContentTitle content examName" id="examName">考试科目</div>
            <div class="examContent">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-row">
                            <span class="title">总分:</span>
                            <span id="examTotalScore"></span>分
                        </div>
                        <div class="form-row">
                            <span class="title">及格分:</span>
                            <span id="passMark"></span>分
                        </div>

                        <div class="form-row">
                            <span class="title">答题时长:</span>
                            <span id="examTime"></span>
                        </div>
                        <div class="form-row">
                            <span class="title">考试时间:</span>
                            <span id="examTimeInterval"></span>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-row">
                            <span class="title">应考人数:</span>
                            <span id="examineNums"></span>
                        </div>
                        <div class="form-row">
                            <span class="title">平均分:</span>
                            <span id="avgScore"></span>分
                        </div>
                        <div class="form-row">
                            <span class="title">最高分:</span>
                            <span id="maxScore"></span>分
                        </div>
                        <div class="form-row">
                            <span class="title">最低分:</span>
                            <span id="minScore"></span>分
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!--全班成绩统计-->
        <div class="score tabContent">
            <div class="scoreAnalysisFun clear">
                <div class="scoreAnalysisGrid">
                    <button type="button" class="btn btn-default export scoreExport pull-right" id="scoreExport">导出答题情况</button>
                    <table class="table table-bordered table-hover table-striped">
                        <thead>
                        <tr>
                            <td id="examineNum">应考人数</td>
                            <td id="passPercent">及格率</td>
                            <td id="max-Score">最高分</td>
                            <td id="min-Score">最低分</td>
                            <td id="avg-Score">平均分</td>
                        </tr>
                        </thead>

                        <tbody id="data">
                        </tbody>

                        <tfoot>
                        <tr id="table bottom" class="table-bordered">
                            <td colspan=5">
                                <div id="page_div">
                                    <div id="right">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
        </br>
        <div id="bottom">
            <button type="button" class="btn btn-primary"
                    onclick="pie()">饼图</button>
            <div id="bar" style="min-width: 310px; height: 400px; margin: 0 auto">
                <input type="radio" name="paint-graph" id="graph-rainbow" checked="checked"/><label for="graph-rainbow">Rainbow</label>
            </div>
        </div>

    </div>

</div>

<script>
    var Barlist=[];
    var BarArr;

    function init(){
        var personNum;
        var avg1,max1,min1;
        var examId = sessionStorage.getItem("id");
        var classId=sessionStorage.getItem("classId");
        var examName=sessionStorage.getItem("examName");
        var startTime=sessionStorage.getItem("startTime");
        var testTime=sessionStorage.getItem("testTime");
        var totalScore=sessionStorage.getItem("totalScore");

        sessionStorage.setItem("examId",examId);
        jQuery("#examName").html(examName);
        jQuery("#examTimeInterval").html(startTime);
        jQuery("#examTime").html(testTime);
        jQuery("#examTotalScore").html(totalScore);
        jQuery("#passMark").html(totalScore*0.6);


        var param={
            "examId":examId
        };
        console.log(param);
        jQuery.post("/teacher/analyse/count",param,function(data){
            console.log(data);
            jQuery("#examineNums").html(data);
            jQuery("#examineNum").html(data);
            personNum=data;

        })
        jQuery.post("/teacher/analyse/max",param,function (max){
            jQuery("#maxScore").html(max);
            jQuery("#max-Score").html(max);
            max1=max;
        })

        jQuery.post("/teacher/analyse/min",param,function (min){
            jQuery("#minScore").html(min);
            jQuery("#min-Score").html(min);
            min1=min;
        })

        jQuery.post("/teacher/analyse/avg",param,function (avg){
            jQuery("#avgScore").html(avg);
            jQuery("#avg-Score").html(avg);
            avg1=avg;
        })

        console.log(personNum);

        var trs="";
        trs+=`
            <tr>
                <td>${personNum}</td>
                <td>60%</td>
                <td>${max1}</td>
                <td>${min1}</td>
                <td>${avg1}</td>
            </tr>
            `;

        jQuery('#data').html(trs);

        var param1={
            "examId":examId,
            "totalScore":totalScore,
            "personNum":personNum
        };
        console.log(param1);

        var myChart = echarts.init(document.getElementById('bar'));
        // 指定图表的配置项和数据
        var option = {
            title: {
                text: ''
            },
            tooltip: {
                headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                pointFormat: '<span style="color:{point.color}"></span>: <b>{series.data:.2f}%</b> of total<br/>'
            },
            legend: {
                data:['合格率','优良率','平均分']
            },
            xAxis: {
                data: ["合格率","优良率","平均分"]
            },
            yAxis: {},
            series: [{
                name: '比例',
                type: 'bar',
                colorByPoint: true,
                data: [],
            }]
        };
        var pass;
        var excellent;
        console.log(avg1);
        jQuery.post("/teacher/analyse/percentage",param1,function(rst){
            console.log(rst);
            BarArr=rst;
            for(var i=0;i<BarArr.length;i++){
                if(i==3){
                    pass=BarArr[3];
                }
                if(i==4){
                    excellent=BarArr[4];
                    pass=pass+BarArr[4];
                }
            }
            option.series[0].data.push(pass);
            option.series[0].data.push(excellent);
            option.series[0].data.push(avg1);
            myChart.setOption(option);
        })
        sessionStorage.setItem("personNum",personNum);
    }
</script>
<script>
    function search(){
        window.location.href="stuList.html";
    }
    function zhu(){
        window.location.href="test.html";
    }
</script>
<!--pie图-->
<script>
    function pie(){
        var examId = sessionStorage.getItem("id");
        var totalScore=sessionStorage.getItem("totalScore");
        var personNum=$("#examineNum").val();
        var param1={
            "examId":examId,
            "totalScore":totalScore,
            "personNum":6
        };

        var myChart = echarts.init(document.getElementById('bar'));
        // 指定图表的配置项和数据
        var option1 = {
            backgroundColor:'#FAFAD2',
            title: {
                text: '各分数段比例统计',
                left: 'center',
                //标题栏的高度，值越大，距离顶部的距离越大
                top: 50,
                //标题栏字体的颜色
                textStyle: {
                    color: '#FFD700'
                }
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                left: 'left',
                data: ['0-20','20-40','40-60','60-80','80-100']
            },
            visualMap: {
                show: false,
                //饼图中在最大值最小值颜色范围中的亮度，值越大颜色越深
                min:10,
                max: 600,
                inRange: {
                    //0-1之间，值越小颜色越深
                    colorLightness: [0, 1]
                }
            },
            series : [
                {
                    //饼图中内容介绍
                    name:'各分数段统计',
                    //统计表的类型
                    type:'pie',
                    //饼图的弧度，值越小生成的饼状图越小
                    radius : '60%',
                    //饼图生成后的位置
                    center: ['50%', '50%'],
                    data:[
                        {value:'', name:'0-20'},
                        {value:'', name:'20-40'},
                        {value:'', name:'40-60'},
                        {value:'', name:'60-80'},
                        {value:'', name:'80-100'}
                    ],
                    itemStyle: {
                        normal:{
                            label:{
                                show:true,
                                formatter: "{b} :\n  {c} \n ({d}%)",
                                position:"inner"
                            }
                        }
                    },
                    roseType: 'radius',
                    //饼状图的外围标签
                    label: {
                        normal: {
                            textStyle: {
                                color: 'rgba(0, 0, 0, 0.3)'
                            }
                        }
                    },
                    //指向外围标签的线条
                    labelLine: {
                        normal: {
                            lineStyle: {
                                color: 'rgba(0, 0, 255, 0.3)'
                            },
                            smooth: 0.2,
                            length: 10,
                            length2: 20
                        }
                    },
                    itemStyle: {
                        normal: {
                            //具体决定了饼状图每一份的颜色显示
                            color: '#FFA07A',
                            //饼状图阴影，值越大阴影亮度越高
                            shadowBlur: 200,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                }
            ]
        };
        jQuery.post("/teacher/analyse/percentage",param1,function(rst){
            console.log(rst);
            BarArr=rst;
            for(var i=0;i<BarArr.length;i++){
                option1.series[0].data.push(BarArr[i]);
            }
            myChart.setOption(option);
        })
    }
</script>

</body>


</html>