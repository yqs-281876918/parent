<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>试题分析</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--    <script src="https://cdn.bootcss.com/echarts/3.7.1/echarts.min.js"></script>-->
    <meta name="MSSmartTagsPreventParsing" content="True" />
    <meta http-equiv="MSThemeCompatible" content="Yes" />
    <meta name="renderer" content="webkit"  />
    <link href="https://itestres.unipus.cn/itest-saas/static/its/lib/sfront/student/css/stu_css.css?v=202203111833" rel="stylesheet">
    <script src="js/bootstrap-table-expandable.js"></script>

    <style>
        .clsTest{
            border-color: #2dbf7f !important;
            color: #2dbf7f !important;
        }
        .h4{
            cursor: pointer;
        }
        #page_div #left{
            float: left;
        }
        #page_div #right{
            float: right;
        }
    </style>

</head>
<body onload="init()">
<div id="container">
    <div class="h4" class="examContentTitle content examName" id="examName">的试题分析</div>
    <div class="choose">
        <div id="choose type" class="questionSelDept dropdown selDept pull-left dropdownBtn open">
            <select id="choose" name="choose" class="form-control">
                <option value="All" selected = "selected">全部题型</option>
                <option value="SingleChoiceQuestion">单选题</option>
                <option value="MultipleChoiceQuestion">多选题</option>
                <option value="Completion">填空题</option>
                <option value="Judgment">判断题</option>
                <option value="ComprehensiveQuestion">综合题</option>
                <option value="CombinationChoice">综合（组合）选择题</option>
                <option value="ProgramProblem">程序题</option>
            </select>
        </div>
    </div>

    <div class="questionAnalysis">
        <div class="questionItems">
            <ul>
                <li >题型</li>
                <li >题号</li>
                <li >题目内容</li>
                <li >答题人数</li>
                <li >正确人数</li>
                <li >得分率</li>
                <li > 查看详情</li>
            </ul>
        </div>

        <div id="data">

        </div>


<!--                <tbody  role="alert" aria-live="polite" aria-relevant="all">-->
<!--                <div id="data">-->
<!--                </div>-->
<!--                <div class="collapse" id="collapseExample">-->
<!--                    <div class="card card-body">-->
<!--                        Some placeholder content for the collapse component. This panel is hidden by default but revealed when the user activates the relevant trigger.-->
<!--                    </div>-->
<!--                </div>-->
<!--                </tbody>-->
                <tfoot>
                <tr>
                    <td colspan="6">
                        <div id="page_div">
                            <div id="left">
                                <span id="pageNum"></span>/<span id="pages"></span>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                共<span id="totals"></span>道题目
                            </div>
                            <div id="right">

                            </div>
                        </div>
                    </td>
                </tr>
                </tfoot>
            </table>
        </div>

    </div>
</div>
<script>
    var pageNum=1;
    var pageSize=10;
    var pageNums=0;
    var BarArr;
    var type;
    var index;

    $(() => {
        $('#choose').change(() => {
            var type = $("#choose").val();
            init(type);
        })
    })
    function init(type){
        var examId = sessionStorage.getItem("examId");
        var examName=sessionStorage.getItem("examName");
        var totalScore=sessionStorage.getItem("totalScore");
        jQuery("#examName").html(examName);

        console.log(type);

        // var param={
        //     "pageNum":pageNum,
        //     "pageSize":pageSize,
        //     "examId":examId,
        //     //"type":type1
        //     "type":'ALL'
        // };
        // console.log(param);
        jQuery.ajax({
            type: 'post',
            url: '/teacher/analyse/itemDetail',
            async: false,
            data: {"pageNum":pageNum, "pageSize":pageSize, "examId":examId, "type":'ALL'},
            success: function (rst) {

            }
        })
        jQuery.ajax({
            type: 'post',
            url: '/teacher/analyse/itemDetail',
            async: false,
            data: {"pageNum":pageNum, "pageSize":pageSize, "examId":examId, "type":'ALL'},
            success: function (rst) {
                //返回的是目标题型题目列表
                console.log(rst);
                //BarArr=Array.from(rst);
                BarArr = rst.list;
                for (var i = 0; i < BarArr.length; i++) {
                    //每一道题
                    var u = BarArr[i];
                    index = i;
                    var type1 = u.subjectType;
                    console.log(type1);
                    if (type1 === "SingleChoiceQuestion") {
                        type1 = "单选题";
                    } else if (type1 === "MultipleChoiceQuestion") {
                        type1 = "多选题";
                    } else if (type1 === "Completion") {
                        type1 = "填空题";
                    } else if (type1 === "Judgment") {
                        type1 = "判断题";
                    } else if (type1 === "ComprehensiveQuestion") {
                        type1 = "综合题";
                    } else if (type1 === "CombinationChoice") {
                        type1 = "综合（组合）选择题";
                    } else if (type1 === "ProgramProblem") {
                        type1 = "程序题";
                    }
                    //var index=i+1;

                    var trs = '';
                    jQuery.ajax({
                        type: 'post',
                        url: '/teacher/analyse/description',
                        async: false,
                        data: {"subjectId": u.subjectId},
                        success: function (rst1) {
                            console.log(rst1);
                            jQuery.ajax({
                                type: 'post',
                                url: '/teacher/analyse/count',
                                async: false,
                                data: {"examId": examId, "totalScore": totalScore},
                                success: function (rst2) {
                                    console.log(rst2);
                                    var total = rst2[0];
                                    jQuery.ajax({
                                        type: 'post',
                                        url: '/teacher/analyse/getRight',
                                        async: false,
                                        data: {"examId": examId, "subjectId": u.subjectId, "total": total},
                                        success: function (rst3) {
                                            console.log(rst3);
                                            var arr1 = rst3;
                                            console.log(arr1);
                                            var right = arr1[0];
                                            var percentage = arr1[1];
                                            jQuery.ajax({
                                                type: 'post',
                                                url: '/teacher/analyse/ABCD',
                                                async: false,
                                                data: {"subjectId": u.subjectId, "examId": examId, "type": u.subjectType},
                                                success: function (rst4) {
                                                    trs = `

                <ul>
                    <li style="cursor:default;display: inline">${type1}</li>
                    <li style="cursor:default;display: inline"">${index}</li>
                    <li style="cursor:default;display: inline"">${rst1}</li>
                    <li style="cursor:default;display: inline"">${total}</li>
                    <li style="cursor:default;display: inline"">${right}</li>
                    <li style="cursor:default;display: inline"">${percentage}%</li>
                </ul>
                <ul>
                <div class="card">
    <div class="card-header" id="heading${u.subjectId}">
        <h2 class="mb-0">
            <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapse${u.subjectId}" aria-expanded="false" aria-controls="collapse${u.subjectId}">
                <div>
                    查看详情
                </div>
            </button>
        </h2>
    </div>
    <div id="collapse${u.subjectId}" class="collapse" aria-labelledby="heading${u.subjectId}" data-parent="#accordionExample">
        <div class="card-body" id="${u.subjectId}">
        111
        </div>
    </div>
</div>
</ul>


                `;
                                                    jQuery('#data').append(trs);
                                                }
                                            })
                                        }

                                    })
                                }
                            })
                        }
                    })
//                 jQuery.post("/teacher/analyse/description",param1,function(rst1){
//                     console.log(rst1);
//                     //根据id查考试人数
//                     var param2={
//                         "examId":examId,
//                         "totalScore":100
//                     };
//                     jQuery.post("/teacher/analyse/count",param2,function (rst2){
//                         console.log(rst2);
//                         var total=rst2[0];
//                         var param3={
//                             "examId":examId,
//                             "subjectId":u.subjectId,
//                             "total":total
//                         };
//                         //查找作对人数
//                         jQuery.post("/teacher/analyse/getRight",param3,function(rst3){
//                             console.log(rst3);
//                             var arr1=rst3;
//                             console.log(arr1);
//                             var right=arr1[0];
//                             var percentage=arr1[1];
//                             var param4={
//                                 "subjectId":u.subjectId,
//                                 "examId":examId,
//                                 "type":u.subjectType
//                             };
//                             console.log(param4);
//                             jQuery.post("/teacher/analyse/ABCD",param4,function(rst4){
//                                 console.log(rst4);
//                             })
//                             //var percentage=Math.round(rst3*100)/rst1;
//                             //console.log(percentage);
//                             trs =`
//
//                 <ul>
//                     <li style="cursor:default;display: inline">${type1}</li>
//                     <li style="cursor:default;display: inline"">${index}</li>
//                     <li style="cursor:default;display: inline"">${rst1}</li>
//                     <li style="cursor:default;display: inline"">${total}</li>
//                     <li style="cursor:default;display: inline"">${right}</li>
//                     <li style="cursor:default;display: inline"">${percentage}%</li>
//                 </ul>
//                 <ul>
//                 <div class="card">
//     <div class="card-header" id="heading${u.subjectId}">
//         <h2 class="mb-0">
//             <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapse${u.subjectId}" aria-expanded="false" aria-controls="collapse${u.subjectId}">
//                 <div>
//                     查看详情
//                 </div>
//             </button>
//         </h2>
//     </div>
//     <div id="collapse${u.subjectId}" class="collapse" aria-labelledby="heading${u.subjectId}" data-parent="#accordionExample">
//         <div class="card-body" id="${u.subjectId}">
//         111
//         </div>
//     </div>
// </div>
// </ul>
//
//
//                 `;
//                             jQuery('#data').append(trs);
//
//                         })
//                     })
//                 })
//             }

                }
            }
        })
    }

</script>

</body>
</html>