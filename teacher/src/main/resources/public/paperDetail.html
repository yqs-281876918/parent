<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>试题分析</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--    <script src="https://cdn.bootcss.com/echarts/3.7.1/echarts.min.js"></script>-->
    <meta name="MSSmartTagsPreventParsing" content="True" />
    <meta http-equiv="MSThemeCompatible" content="Yes" />
    <meta name="renderer" content="webkit"  />
    <link href="https://itestres.unipus.cn/itest-saas/static/its/lib/sfront/student/css/stu_css.css?v=202203111833" rel="stylesheet">
    <script src="js/bootstrap-table-expandable.js"></script>

    <style>
        .clsTest{
            border-color: #2dbf7f !important;
            color: #2dbf7f !important;
        }
        .h4{
            cursor: pointer;
        }
        #page_div #left{
            float: left;
        }
        #page_div #right{
            float: right;
        }
    </style>

</head>
<body onload="init()">
<div id="container">
    <div class="examContentTitle content examName" id="examName">的试题分析</div>
    <div id="choose type" class="questionSelDept dropdown selDept pull-left dropdownBtn open">
        <select id="choose" name="choose" class="form-control">
            <option value="All" selected = "selected">全部题型</option>
            <option value="SingleChoiceQuestion">单选题</option>
            <option value="MultipleChoiceQuestion">多选题</option>
            <option value="Completion">填空题</option>
            <option value="Judgment">判断题</option>
            <option value="ComprehensiveQuestion">综合题</option>
            <option value="CombinationChoice">综合（组合）选择题</option>
            <option value="ProgramProblem">程序题</option>
        </select>
    </div>
    <div class="questionAnalysis">
        <div class="questionItems">
            <table class="table table-hover table-expandable"  style="word-break:break-all; word-wrap:break-all;" >
                <thead>
                <tr>
                    <td >题型</td>
                    <td >题号</td>
                    <td >题目内容</td>
                    <td >答题人数</td>
                    <td >正确人数</td>
                    <td >得分率</td>
                    <td> 查看详情</td>
                </tr>

                </thead>
                <tbody id="data" role="alert" aria-live="polite" aria-relevant="all">
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="6">
                        <div id="page_div">
                            <div id="left">
                                <span id="pageNum"></span>/<span id="pages"></span>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                共<span id="totals"></span>道题目
                            </div>
                            <div id="right">

                            </div>
                        </div>
                    </td>
                </tr>
                </tfoot>
            </table>
        </div>
<!--        <div class="panel-group allContent" id="allContent" role="tablist" aria-multiselectable="true">-->
<!--            <div class="panel panel-default everyContent">-->
<!--                <div class="panel-heading" role="tab" id="heading">-->
<!--                    <ul></ul>-->
<!--                </div>-->
<!--                <div id="collapse detail" class="collapse show" role="tabpanel" aria-labelledby="heading" aria-expanded="true" style>-->
<!--                    <div class="panel-body">-->
<!--                        <div class="questionDetail clear title" >-->
<!--                            <td class="questionLeft titleAnswer pull-left">答题情况</td>-->
<!--                            <td class-="questionRight titleScore pull-left">得分率</td>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

    </div>
</div>
<script>
    var pageNum=1;
    var pageSize=10;
    var pageNums=0;
    var BarArr;
    //var subject;
    var type;
    var index;

    function init(){
        var examId = sessionStorage.getItem("id");
        var examName=sessionStorage.getItem("examName");
        jQuery("#examName").html(examName);
        var type = $("#choose").val();

        var param={
            "pageNum":pageNum,
            "pageSize":pageSize,
            "examId":13,
            //"type":type1
            type:'ALL'
        };
        jQuery.post("/teacher/analyse/itemDetail",param,function(rst){

            //返回的是目标题型题目列表
            console.log(rst);
            //BarArr=Array.from(rst);
            BarArr=rst.list;
            //alert(BarArr);
            //alert(BarArr.length);
            for(var i=0;i<BarArr.length;i++){
                //每一道题
                var u=BarArr[i];
                index=i;
                var subject=u.subjectId;
                var type1=u.subjectType;
                console.log(type1);
                if(type1==="SingleChoiceQuestion"){type1="单选题";}
                else if(type1==="MultipleChoiceQuestion"){type1="多选题";}
                else if(type1==="Completion"){type1="填空题";}
                else if(type1==="Judgment"){type1="判断题";}
                else if(type1==="ComprehensiveQuestion"){type1="综合题";}
                else if(type1==="CombinationChoice"){type1="综合（组合）选择题";}
                else if(type1==="ProgramProblem"){type1="程序题";}
                //var index=i+1;

                var trs='';
                var param1={
                    "subjectId":subject
                };

                console.log(param1);
                //根据id查题目描述
                jQuery.post("/teacher/analyse/description",param1,function(rst1){
                    console.log(rst1);
                    //根据id查考试人数
                    var param2={
                        "examId":13,
                        "totalScore":100
                    };
                    jQuery.post("/teacher/analyse/count",param2,function (rst2){
                        console.log(rst2);
                        var total=rst2[0];
                        var param3={
                            "examId":13,
                            "subjectId":subject,
                            "total":total
                        };
                        //查找作对人数
                        jQuery.post("/teacher/analyse/getRight",param3,function(rst3){
                            console.log(rst3);
                            var arr1=rst3;
                            console.log(arr1);
                            var right=arr1[0];
                            var percentage=arr1[1];
                            //var percentage=Math.round(rst3*100)/rst1;
                            //console.log(percentage);
                            trs+=`
                <tr>
                    <td style="cursor:default;">${type1}</td>
                    <td style="cursor:default;">${index}</td>
                    <td style="cursor:default;">${rst1}</td>
                    <td style="cursor:default;">${total}</td>
                    <td style="cursor:default;">${right}</td>
                    <td style="cursor:default;">${percentage}%</td>
                    <!--                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">-->
<!--        <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>-->
<!--        <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>-->
<!--    </svg>-->
<!--                    <td class="bi bi-card-text"  data-toggle="tooltip" data-placement="top" data-original-title="查看答题情况"></i>-->
                </tr>
                <tr></tr>
                `;
                            jQuery('#data').html(trs);
                        })
                    })
                })

            }

            pageNums=rst.pages;
            jQuery("#pages").html(pageNums);
            jQuery("#pageNum").html(pageNum);
            jQuery("#totals").html(rst.total);




        })
    }
</script>

</body>
</html>