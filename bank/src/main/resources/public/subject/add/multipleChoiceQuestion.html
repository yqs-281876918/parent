<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>多选题添加</title>
    <link rel="stylesheet" href="../../css/add.css">
</head>
<body>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/wangeditor@latest/dist/wangEditor.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="/bank/js/submit.js"></script>
<!--多选题面板-->
<div class="editor multipleChoiceEditor outer">
    <script>
        var multipleChoiceItemCount = 4

        function onAddMultipleChoiceItem() {
            var html = "<div class='multipleChoiceItem'>\n" +
                String.fromCharCode(65 + multipleChoiceItemCount) +
                ". <textarea name='options' type='text' style='width: 800px; height: 18px'></textarea>\n" +
                "<br/>\n" +
                "</div>"
            $("div.multipleChoiceItems").append(html)
            // <input class="multipleChoiceAnswer" type="checkbox" name="answer" value="1">A
            html = "<div class='multipleChoiceAnswer' style='display: inline-block'>\n" +
                "<input type='checkbox' name='answers' value='" + (multipleChoiceItemCount + 1) + "'>"
                + String.fromCharCode(65 + multipleChoiceItemCount) +
                "<br/>\n" +
                "</div>"
            $("div.multipleChoiceAnswers").append(html)
            multipleChoiceItemCount++;
        }

        function onDeleteMultipleChoiceItem() {
            if (multipleChoiceItemCount == 1) {

            } else {
                $("div.multipleChoiceItem").eq(-1).remove()
                $("div.multipleChoiceAnswer").eq(-1).remove()
                multipleChoiceItemCount--;
            }
        }

        jQuery(function () {
            var t = new Date();
            var year = t.getFullYear();
            var month = t.getMonth() + 1;
            if (month < 10) {
                month = '0' + month
            }
            var day = t.getDate();
            if (day < 10) {
                day = '0' + day;
            }
            var time = year + "-" + month + "-" + day;
            console.log(time);
            document.getElementById("multipleChoiceDate").value = time;
        })
    </script>
    <form id="subject">
        <div class="upper">
            <div class="title">
                <span class="tip"> 题干  </span>
            </div>
            <div id="multipleChoiceEditor" onchange="alert('11')"></div>
            <input type="button" value="添加选项" onclick="onAddMultipleChoiceItem()"/>
            <input type="button" value="删除选项" onclick="onDeleteMultipleChoiceItem()"/>
            <input type="hidden" id="multipleChoiceDescription" name="description" value="">
            设置选项:
            <br/>
            <div class="multipleChoiceItems">
                <div class="multipleChoiceItem">
                    A. <textarea name="options" type="text" style="width: 800px; height: 18px"></textarea>
                    <br/>
                </div>
                <div class="multipleChoiceItem">
                    B. <textarea name="options" type="text" style="width: 800px; height: 18px"></textarea>
                    <br/>
                </div>
                <div class="multipleChoiceItem">
                    C. <textarea name="options" type="text" style="width: 800px; height: 18px"></textarea>
                    <br/>
                </div>
                <div class="multipleChoiceItem">
                    D. <textarea name="options" type="text" style="width: 800px; height: 18px"></textarea>
                    <br/>
                </div>
            </div>
        </div>
        <div class="inner">
            <span class="title2">题目属性 </span>
            <div class="line"></div>
            <div class="classify">
                题目所属分组：
                <div class="line"></div>
                <div class="multipleChoiceCourseId">
                    <div style="display: inline-block">所属课程：</div>
                    <div style="display: inline-block">
                        <div>
                            <select class="button2" id="courseID" name="courseID"></select>
                        </div>
                    </div>
                    <div style="display: inline-block" class="button2">所属知识点：</div>
                    <div style="display: inline-block" id="class2ndID">
                        <div class="class2ndID">
                            <select class="button2">

                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="star">
                题目难度星级:
                <div class="line"></div>
                <div class="difficulty">
                    <select class="button2" id="multipleChoiceDifficulty" name="difficulty">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
            </div>
            <div class="score">
                题目建议分值：
                <div class="line"></div>
                <div class="multipleChoiceRecommendScore">
                    <input name="recommendScore" type="text">
                </div>
            </div>
            <div class="answer">
                设置答案:
                <div class="button2" class="multipleChoiceAnswers">
                    <div class="multipleChoiceAnswer" style="display: inline-block">
                        <input type="checkbox" name="answers" value="1">A
                        <br/>
                    </div>
                    <div class="multipleChoiceAnswer" style="display: inline-block">
                        <input type="checkbox" name="answers" value="2">B
                        <br/>
                    </div>
                    <div class="multipleChoiceAnswer" style="display: inline-block">
                        <input type="checkbox" name="answers" value="3">C
                        <br/>
                    </div>
                    <div class="multipleChoiceAnswer" style="display: inline-block">
                        <input type="checkbox" name="answers" value="4">D
                        <br/>
                    </div>
                </div>
                <br/>
            </div>
            设置题目时间:
            <input id="multipleChoiceDate" name="date" type="date"/>
            <br/>
            <div class="submit">
                <button type="button" class="btn btn-primary" onclick="submitSubject('#subject','/bank/addSubject/multipleChoice')">
                    提交至题库
                </button>
            </div>
        </div>
    </form>
</div>
<script>
    $.fn.serializeObject = function () {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function () {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    //初始化课程信息
    function init() {
        jQuery.get("/bank/classify/findAllCourse", function (rst) {
            var trs = ''
            var superId = rst[0].id;
            for (var i = 0; i < rst.length; i++) {
                var u = rst[i];
                trs += `
                    <option value="${u.id}">${u.classifyName}</option>
                `
            }
            $("#courseID").append(trs);
            jQuery.get("/bank/classify/findAllKnowledge", function (rst2) {
                var trs2 = ''
                $("div.class2ndID").remove();
                trs2 += `<div class="class2ndID">
                    <select name="class2ndID">
                    `
                for (var i = 0; i < rst2.length; i++) {
                    var u = rst2[i];
                    if (superId == u.superClassId) {
                        trs2 += `<option value="${u.id}">${u.classifyName}</option>`
                    } else {

                    }
                }
                trs2 += `</select>
                </div>`
                $("#class2ndID").append(trs2);
            })
        })
    }

    jQuery(function () {
        init();
    })
    //监听选择的课程，呈现相应的知识点信息
    $(() => {
        $('#courseID').change(() => {
            $("div.class2ndID").remove();
            jQuery.get("/bank/classify/findAllKnowledge", function (rst) {
                var trs = ""
                trs += `<div class="class2ndID">
                    <select name="class2ndID">
                    `
                var superId = $("#courseID").val()
                for (var i = 0; i < rst.length; i++) {
                    var u = rst[i];
                    if (superId == u.superClassId) {
                        trs += `<option value="${u.id}">${u.classifyName}</option>`
                    } else {

                    }
                }
                trs += `</select>
                </div>`
                $("#class2ndID").append(trs);
            })
        })
    })

</script>
<script>
    const E = window.wangEditor
    const multipleChoiceEditor = new E("#multipleChoiceEditor")
    multipleChoiceEditor.config.placeholder = '请输入题目描述'
    multipleChoiceEditor.config.uploadImgServer = '/upload-img'
    multipleChoiceEditor.config.uploadFileName = 'file';
    multipleChoiceEditor.config.uploadImgMaxSize = 2 * 1024 * 1024
    multipleChoiceEditor.config.uploadVideoServer = '/upload-video'
    multipleChoiceEditor.config.uploadVideoMaxSize = 1 * 1024 * 1024 * 1024
    multipleChoiceEditor.config.onchange = function (newHtml) {
        $("#multipleChoiceDescription").val(newHtml)
    }
    multipleChoiceEditor.create()
</script>
</body>
</html>