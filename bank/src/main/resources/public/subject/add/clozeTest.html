<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>完型填空添加</title>
    <link rel="stylesheet" href="../../css/Question.css">
</head>
<body>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/wangeditor@latest/dist/wangEditor.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<!--完型填空面板-->
<div class="editor clozeTestEditor outer">
    <script>
        var clozeTestItemCount=10
        function onAddClozeTestItem()
        {
            html="<div class='clozeTestTopic'>\n"+
                (clozeTestItemCount+1)+". "+
                "A.<textarea name='options' type='text' style='height: 18px'></textarea> " +
                "B.<textarea name='options' type='text' style='height: 18px'></textarea> " +
                "C.<textarea name='options' type='text' style='height: 18px'></textarea> " +
                "D.<textarea name='options' type='text' style='height: 18px'></textarea>"+
                "\n"+
                "</div>"
            $("div.clozeTestTopics").append(html)
            html="<div class='clozeTestAnswer'>\n"+
                (clozeTestItemCount+1)+". "+
                "<select name='answers'class=\"button2\">\n"+
                "<option value='1'>A</option>\n" +
                "<option value='2'>B</option>\n" +
                "<option value='3'>C</option>\n" +
                "<option value='4'>D</option>"+
                "\n"+
                "</select>"+
                "<br/>"+
                "</div>"
            $("div.clozeTestAnswers").append(html)
            clozeTestItemCount++;
        }
        function onDeleteClozeTestItem()
        {
            if (clozeTestItemCount==1){
            }else {
                $("div.clozeTestTopic").eq(-1).remove()
                $("div.clozeTestAnswer").eq(-1).remove()
                clozeTestItemCount--;
            }
        }
        jQuery(function (){
            var t = new Date();
            var year = t.getFullYear();
            var month = t.getMonth()+1;
            if (month<10){
                month = '0'+month
            }
            var day = t.getDate();
            if(day<10){
                day = '0'+day;
            }
            var time = year+"-"+month+"-"+day;
            console.log(time);
            document.getElementById("clozeTestDate").value=time;
        })
    </script>
    <div class="upper">
        <div class="title">
            <span class="tip"> 题干  </span>
        </div>
    <div id="clozeTestEditor" onchange="alert('11')"></div>
    <button onclick="onAddClozeTestItem()">添加题目</button>
    <button onclick="onDeleteClozeTestItem()">删除题目</button>
    <form id="subject">
        <input type="hidden" id="clozeTestDescription" name="description" value="">
        题目：
        <div class="clozeTestTopics">
            <div class="clozeTestTopic">
                1. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                2. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                3. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                4. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                5. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                6. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                7. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                8. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                9. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
            <div class="clozeTestTopic">
                10. A.<textarea name="options" type="text" style="height: 18px"></textarea>
                B.<textarea name="options" type="text" style="height: 18px"></textarea>
                C.<textarea name="options" type="text" style="height: 18px"></textarea>
                D.<textarea name="options" type="text" style="height: 18px"></textarea>
            </div>
        </div>
      </div>
    <div class="inner">
        <span class="title2">题目属性 </span>
        <div class="line"></div>
        <div class="classify"> 题目所属分组：
            <div class="line"></div>
        <div class="clozeTestCourseId">
            <div style="display: inline-block">所属课程：</div>
            <div style="display: inline-block">
                <div>
                    <select class="button2" id="courseID" name="courseID"></select>
                </div>
            </div>
            <div style="display: inline-block">所属知识点：</div>
            <div style="display: inline-block" id="class2ndID">
                <div class="class2ndID">
                    <select class="button2">

                    </select>
                </div>
            </div>
        </div>
        </div>

        <div class="star">
        题目难度星级:
        <div class="line"></div>
        <div class="difficulty">
            <select id="clozeTestDifficulty" class="button2" name="difficulty">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>
        </div>
        <div class="score">
        题目建议分值：
            <div class="line"></div>
        <div class="clozeTestRecommendScore">
            <input name="recommendScore" type="text">
        </div>
        </div>
        <div class="answer">
        设置答案:
        <div class="clozeTestAnswers" >
            <div class="clozeTestAnswer">
                1.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                2.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                3.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                4.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                5.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                6.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                7.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                8.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                9.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
            <div class="clozeTestAnswer">
                10.
                <select name="answers"class="button2">
                    <option value="1">A</option>
                    <option value="2">B</option>
                    <option value="3">C</option>
                    <option value="4">D</option>
                </select>
                <br/>
            </div>
        </div>
        <br/>
        设置题目时间:
        <input class="button2" id="clozeTestDate" name="date" type="date"/>
        <br/>
            <div class="submit">
        <button type="button" class="btn btn-primary" onclick="submitSubject()">提交至题库</button>
            </div>
                </form>
        </div>
</div>
</div>
<script>
    $.fn.serializeObject = function() {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };
    function submitSubject(){
        var form = jQuery("#subject").serializeObject();
        var introduction = form.description;
        var msg = introduction.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi, '\n').replace(/<br\/?>/gi, '\n').replace(/<[^>/]+>/g, '').replace(/(\n)?<\/([^>]+)>/g, '').replace(/\u00a0/g, ' ').replace(/&nbsp;/g, ' ').replace(/<\/?(img)[^>]*>/gi, '').replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"\'").replace(/&quot;/g,"\"").replace(/<\/?.+?>/g,"")
        if (msg.length>15){
            msg = msg.slice(0,15)
            msg = msg + "..."
        }else{

        }
        var param={
            "difficulty":form.difficulty,
            "date":form.date,
            "courseID":form.courseID,
            "class2ndID":form.class2ndID,
            "recommendScore":form.recommendScore,
            "introduction":msg,
            "description":form.description,
            "options":form.options,
            "answers":form.answers
        };
        jQuery.post("/bank/addSubject/clozeTest",param,function (rst){
            if (rst =="添加成功"){
                alert("添加成功!")
            }else{
                alert("添加失败!")
            }
        })
    }
    //初始化课程信息
    function init(){
        jQuery.get("/bank/classify/findAllCourse",function (rst){
            var trs = ''
            var superId = rst[0].id;
            for (var i=0;i<rst.length;i++){
                var u = rst[i];
                trs +=`
                    <option value="${u.id}">${u.classifyName}</option>
                `
            }
            $("#courseID").append(trs);
            jQuery.get("/bank/classify/findAllKnowledge",function (rst2){
                var trs2 = ''
                $("div.class2ndID").remove();
                trs2 += `<div class="class2ndID">
                    <select name="class2ndID">
                    `
                for (var i=0;i<rst2.length;i++){
                    var u = rst2[i];
                    if(superId == u.superClassId){
                        trs2 += `<option value="${u.id}">${u.classifyName}</option>`
                    }else{

                    }
                }
                trs2 += `</select>
                </div>`
                $("#class2ndID").append(trs2);
            })
        })
    }
    jQuery(function (){
        init();
    })
    //监听选择的课程，呈现相应的知识点信息
    $(() => {
        $('#courseID').change(() => {
            $("div.class2ndID").remove();
            jQuery.get("/bank/classify/findAllKnowledge",function (rst){
                var trs = ""
                trs += `<div class="class2ndID">
                    <select name="class2ndID">
                    `
                var superId = $("#courseID").val()
                for (var i=0;i<rst.length;i++){
                    var u = rst[i];
                    if(superId == u.superClassId){
                        trs += `<option value="${u.id}">${u.classifyName}</option>`
                    }else{

                    }
                }
                trs += `</select>
                </div>`
                $("#class2ndID").append(trs);
            })
        })
    })

</script>
<script>
    const E = window.wangEditor
    const clozeTestEditor = new E("#clozeTestEditor")
    clozeTestEditor.config.placeholder = '请输入题目描述'
    clozeTestEditor.config.uploadImgServer = '/upload-img'
    clozeTestEditor.config.uploadFileName = 'file';
    clozeTestEditor.config.uploadImgMaxSize=2*1024*1024
    clozeTestEditor.config.uploadVideoServer = '/upload-video'
    clozeTestEditor.config.uploadVideoMaxSize = 1 * 1024 * 1024 * 1024
    clozeTestEditor.config.onchange=function (newHtml)
    {
        $("#clozeTestDescription").val(newHtml)
    }
    clozeTestEditor.create()
</script>
</body>
</html>